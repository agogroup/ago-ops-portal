# 機能要件書

## ステータス: Phase 1 設計完了

---

## 1. プロジェクト背景

### 解決したい課題

1. **人員配置の不可視**
   - 誰がどの現場にいるか、一覧で把握できない
   - Googleカレンダー頼りで、バッティングが発生
   - 事例：塗装中の現場に産廃業者が入りかけた

2. **TEKO配車の非効率**
   - 工程表を見て「いつゴミが出るか」を人が判断している
   - 複数現場のルート最適化ができていない

3. **情報共有の遅延**
   - 現場状況が関係者にリアルタイムで伝わらない
   - 「今どの現場がどうなっているか」の把握に時間がかかる

4. **連絡先の散在**
   - 職人・業者の連絡先が個人のスマホに分散

### 期待する効果

- 全関係者の動きを一画面で把握（CTI機能）
- TEKO配車の判断時間短縮
- 現場状況の可視化
- 連絡先の一元管理

### 経緯

- 林さんにCTIシステムのカスタマイズを依頼予定だったが、対応スピードに懸念
- AI駆動開発で自社ツールとして構築する方針に転換
- 将来的には建設業界向けに外販も視野

---

## 2. ユーザーストーリー

### 菅野隆太（社長）として

- [ ] 全現場・全人員の動きを一覧で把握したい
- [ ] 「暇な人」が一目でわかるようにしたい
- [ ] バッティング（作業の競合）を事前に防ぎたい

### 染谷雅人（TEKO現場管理）として

- [ ] 今日・明日のTEKO配車予定を一覧で見たい
- [ ] 各現場のゴミ発生タイミングを把握したい
- [ ] 他の業者（三十興業等）の動きも確認したい

### 菅優伍（TEKOデスク管理）として

- [ ] 全現場の進捗を一目で確認したい
- [ ] タイムチャートで誰がどこにいるか把握したい
- [ ] 学習のため、過去の配車履歴を振り返りたい

### 堀川寿人/トラ（現場管理）として

- [ ] 自分が担当する現場の工程を確認したい
- [ ] TEKOや他業者の到着予定を知りたい
- [ ] 職人への連絡先をすぐ調べたい

### 梅内光（積算・工程準備）として

- [ ] 作成した工程表を関係者に共有したい
- [ ] 工程変更時に関係者へ通知したい
- [ ] 各業者の空き状況を確認して調整したい

---

## 3. 機能一覧

### Phase 1: プロトタイプ（今回開発）

| 機能 | 概要 | 優先度 |
|------|------|--------|
| タイムチャート | 縦軸:人員/会社、横軸:日時で一覧表示 | 高 |
| 現場一覧表示 | 進行中の現場を一覧表示 | 高 |
| 統合カレンダー | TEKO + 管理者 + 外注（会社単位）の予定表示 | 高 |
| 作業内容表示 | 各予定に作業種別（軽鉄、ボード、クロス等）を表示 | 高 |
| 連絡先検索 | 会社・職人名で検索、ワンタップ発信 | 高 |

### Phase 2: 効率化

| 機能 | 概要 | 優先度 |
|------|------|--------|
| 職人単位への展開 | 会社単位 → 個人単位に詳細化 | 中 |
| ゴミ発生タイミング自動算出 | 工程から「この日にゴミが出る」を表示 | 中 |
| 配車ルート提案 | 複数現場を効率的に回る順序を提案 | 中 |
| 工程変更通知 | 変更時にLINE通知 | 中 |
| 道具リスト自動表示 | 作業種別に応じた必要道具を提示 | 中 |

### Phase 3: 高度化（CTI本格機能）

| 機能 | 概要 | 優先度 |
|------|------|--------|
| 特殊手当計算 | 夜勤・ロープアクセス等の手当自動計算 | 低 |
| 案件別経費集計 | 日報から経費・人工を自動集計 | 低 |
| 配車履歴分析 | 過去データから傾向を分析 | 低 |
| 産廃コスト試算 | ゴミ量から処理費用を概算 | 低 |

---

## 4. データ構造設計

### 基本方針

**会社 → 職人の親子構造**で設計し、Phase 1では会社単位、Phase 2で職人単位に展開可能にする。

### 主要エンティティ

```
[現場 Site]
├── id
├── name（現場名）
├── address（住所）
├── status（進行中/完了/予定）
├── start_date / end_date
└── schedules[] → [スケジュール]

[会社 Company]
├── id
├── name（会社名）
├── type（TEKO/内装/電気/解体/産廃...）
├── contact（代表連絡先）
└── workers[] → [職人]

[職人 Worker]
├── id
├── name
├── company_id → [会社]
├── phone
└── skills[]（作業可能な種別）

[スケジュール Schedule]
├── id
├── site_id → [現場]
├── company_id → [会社]
├── worker_id → [職人]（Phase 2で使用、Phase 1はnull可）
├── date
├── time_start / time_end
├── work_type（軽鉄/ボード/クロス/ゴミ回収...）
└── notes
```

### 作業種別マスタ（Phase 1で用意）

| work_type | 表示名 | ゴミ発生 | 備考 |
|-----------|--------|----------|------|
| light_steel | 軽量鉄骨 | あり | コッパが出る |
| board | ボード | あり | コッパが出る |
| wallpaper | クロス | あり | 紙ゴミ |
| tile_carpet | タイルカーペット | あり | 端材 |
| demolition | 解体 | あり | 大量 |
| garbage | ゴミ回収 | - | TEKO作業 |
| electrical | 電気工事 | 少量 | |
| site_management | 現場管理 | - | |

---

## 5. 画面構成

```
[ホーム]
├── [タイムチャート] ← メイン画面
│   ├── 日付切替（今日/明日/週間）
│   ├── 縦軸：会社/人員
│   ├── 横軸：時間
│   └── セル：現場名・作業種別
│
├── [現場一覧]
│   ├── ステータスフィルタ（進行中/予定/完了）
│   └── [現場詳細]
│       ├── 基本情報
│       ├── 工程表
│       └── 関係者一覧
│
├── [スケジュール登録]
│   ├── 現場選択
│   ├── 会社/人員選択
│   ├── 日時選択
│   └── 作業種別選択
│
└── [連絡先]
    ├── 会社一覧
    ├── 職人検索
    └── ワンタップ発信
```

---

## 6. 非機能要件

### 利用環境

- スマートフォン（主）：現場での確認
- PC（副）：事務所での入力・管理

### 性能

- タイムチャート表示: 2秒以内
- 検索: 1秒以内

### セキュリティ

- 関係者のみアクセス可能（URL共有 or 簡易認証）
- 機密情報（債務、契約金額等）は含めない

### 可用性

- オフライン時は直近データをキャッシュ表示（理想）

---

## 7. 技術選定

### 方針

Cursor + Claude によるAI駆動開発で構築。

### 理由

- CTI機能（タイムチャート）のカスタマイズ性を確保
- Phase 2以降の拡張に対応
- 外販を視野に入れた自社資産化
- リポジトリに直接コード生成できる効率性
- 段階的な改善・機能追加が容易

### 採用ツール

| ツール | 用途 |
|--------|------|
| Cursor + Claude | AI駆動開発（コード生成・修正） |
| Vite | 開発サーバー・ビルド |
| Vercel | ホスティング |
| Supabase or JSON | データ保存 |

---

## 8. 外部連携

### Phase 1

- なし（スタンドアロン）

### Phase 2以降（検討）

| サービス | 連携内容 |
|----------|----------|
| LINE | 工程変更通知 |
| Googleマップ | 現場住所からルート表示 |
| ANDPAD | PDFエクスポートで連携（API不使用） |

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-12-08 | 初版作成 |
| 2025-12-08 | CTI機能統合、会社単位管理、データ構造追加 |
